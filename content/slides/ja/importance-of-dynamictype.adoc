---
title: DynamicTypeについて
created_at: 2017-09-12
presentation: revealjs
---

[.center]
== Dynamic Type について

[.noboder]
image::/assets/img/book_yomu_mushimegane.png[]

アプリ部 中澤

== Dynamic Type とは？

[%step]
* システム全体で文字の大きさを切り替える為の仕組み
* **サイズカテゴリ** に応じて文字を拡大・縮小

+++
<img class="fragment fade-in" src="/assets/img/IMG_35DE5D0FE005-1.jpeg" height="700">
<img class="fragment fade-in" src="/assets/img/2017-09-13 21.37.30.png" height="700">
<img class="fragment fade-in" src="/assets/img/IMG_56C6FC8F173E-1.jpeg" height="700">
+++

[NOTE.speaker]
--
基本は7サイズ。この画面の「さらに大きな文字」スイッチをオンにすると、
さらに大きい5サイズを選べるようになり、全12サイズから選択可能になる。
--

== 細かく適用可能

例えば…

[%step]
* アプリでサイズカテゴリを変える
* ある画面でのみサイズカテゴリを変える

+++
<img class="fragment fade-in" src="/assets/img/xxxxfdfafd.jpg">
<img class="fragment fade-in" src="/assets/img/Bitmap2.jpg">
<img class="fragment fade-in" src="/assets/img/Bitmap.jpg">
<p class="fragment fade-in">
    <br/>
    （ただし条件がそろえば...）
</p>
+++

== Dynamic Type に対応しているアプリ

* Apple純正アプリのほぼ全て
* Twitter
* Facebook
* LINE
* など

== なぜ今さら Dynamic Type？

[NOTE.speaker]
--
iOS 7 からすでにある。
--

+++
<p class="fragment fade-in">
    iOS 11 で色々変わった為。
</p>
+++

[%step]
* カスタムフォントも Dynamic Type で使えるように
* 画像も Dynamic Type でスケールできるように
* コントロールセンターから簡単に設定可能に
* 文字サイズのリミッターが解除
* 純正アプリの多くが Dynamic Type に対応
* 今年の WWDC で関連するセッションが2つ (No.245, 812)

+++
<p class="fragment fade-in">
    ↓<br/>
    これからアツくなる！
</p>
+++

[NOTE.speaker]
--
* 今まで設定アプリから出ないと設定できなかった。
より一層重要度の高い機能になったといえる。

* Dynamic Type は iOS 7 からある機能。
--

== Dynamic Typeは誰にとってどんな機能か

* ユーザー にとって
* デザイナー にとって
* エンジニア にとって
* QA にとって
* PL にとって

== ユーザーにとっての Dynamic Type

[%step]
* 自分にとって見やすい文字サイズで表示できる
* 非対応アプリにイライラ
* 中途半端に対応にはもっとイライラ

+++
<img class="fragment fade-in" src="/assets/img/IMG_90FB46A2B68D-1.jpeg" height="500">
<img class="fragment fade-in" src="/assets/img/IMG_322498D47518-1.jpeg" height="500">
+++

== デザイナーにとっての Dynamic Type

[%step]
* フォントサイズを細かく指定するケースが減る
* 各 Text Style がどういう時に使われるのかの理解が必要

== エンジニアにとっての Dynamic Type

[%step]
* フォントの定義用クラスを作っておく必要がなくなる
* サイズカテゴリの違いで表示が崩れないようにするテクが必要
* デザイン指示書で指定されていなければ使わない

[NOTE.speaker]
--
* 最初にコツコツ指定しておけば、
あとあと対応することになってもガッツリ労力をかけなくて済む

* 結局、実案件では、「このフォントあと少し小さく」とか言われるので
--

== QA にとっての Dynamic Type

[%step]
* 微妙なフォントサイズ違いの見逃しが起こりづらい
* テスト項目が増える
* すごく増えるかも…

== PL にとっての Dynamic Type

[red]#あまり対応したくないかも…#

[%step]
* 「バージョン差異とか、不安定要素まだ多いし…」
* 「Dynamic Type未対応でも別に評価下がらないし…」
* 「お客さんにDynamic Type使う承認得るの面倒そうだし…」
* 「お爺ちゃんその機能たぶん知らないし…」
* 「お爺ちゃん愛用の虫眼鏡使うし…」

[NOTE.speaker]
--
>お客さんの想像と違った場合

例えば、「この文字サイズだけもっと大きくしてほしい」
とかの場合、エンジニアは嫌な顔をする。
--

[.center]
== どうすれば Dynamic Type に対応できるか？

+++
<p class="fragment fade-in">
    ↓<br/>
    決められた<strong>テキストスタイル</strong>をUILabel等に設定する
</p>
+++

[%notitle]
== Apple Human Interface Guideline

image::/assets/img/skitched-20170918-212145.png[canvas,size=contain]

[.center]
== Text Style デモ

== Text Style は以前から使用が推奨されている

image::/assets/img/Pasted_Image_2017_11_24_6_40.png[height=850]

Human Interface Guidelines の Typography より

== サイズは色んな方法で設定可能

[%step]
* 設定アプリ → 一般 → アクセシビリティ → さらに大きな文字
* Accessibility Inspector
* [iOS11] コントロールセンター

+++
<img class="fragment fade-in" src="/assets/img/IMG_2924.jpg">
<img class="fragment fade-in" src="/assets/img/IMG_2DEFED796460-1.jpg" height="500">
+++

[NOTE.speaker]
--
* Accessibility Inspector
** Xcode に入っている。Macから操作可能になる
** 実機・シミュレーター両方で設定可能。
** シミュレータには今のところコントロールセンターの設定画面自体ないので使えない。
--

[.center]
== 実装方法

== Interface Builder で

テキストを表示するビューに設定項目がある

+++
<img class="fragment fade-in" src="/quiver-image-url/8C38A9A850A6B80D8FCA8D482319C0ED.jpg" height="300">
<img class="fragment fade-in" src="/assets/img/skitched-20171120-191813.jpg" height="450">
+++

[%step]
* Automatically Adjusts Font:
** ON: サイズ変更後、即座に反映
** OFF: サイズ変更後、画面を再度表示し直すと反映

[NOTE.speaker]
--
Automatically Adjusts Font:
- 基本的にチェックしておいた方が良い。
- レイアウトを自前でやってる時に必要かもしれない程度のもの
--

== コードで指定する

[source,swift]
----
// Font
label.font = UIFont.preferredFont(
    forTextStyle: UIFontTextStyle.body)

// Automatically Adjusts Font
label.adjustsFontForContentSizeCategory = true
----

[NOTE.speaker]
--
チェックを外すケース:
実際のフォント変更は独自のタイミングで行いたい時とか？
あまり遭遇したくないケース...
- UIAccessibilityContentSizeCategoryImageAdjusting
--

[.center]
== サイズカテゴリ一覧

* XSmall
* small
* medium
* large (iOS のデフォルト値)
* XLarge
* XXLarge
* XXXLarge
* [red]#accessibilityMedium#
* [red]#accessibilityLarge#
* [red]#accessibilityXLarge#
* [red]#accessibilityXXLarge#
* [red]#accessibilityXXXLarge#

== 特定の画面にサイズカテゴリを設定する

[source,swift]
----
// childVC のサイズカテゴリを small にする
let trait = UITraitCollection(preferredContentSizeCategory:
        UIContentSizeCategory.small)

childVC.parent
    .setOverrideTraitCollection(
        trait,
        forChildViewController: childVC)

// 値の呼び出し
childVC
    .traitCollection
    .preferredContentSizeCategory
----

== アプリ全体でサイズカテゴリを設定

[source,swift]
----
class Window: UIWindow {
    override var traitCollection: UITraitCollection {
        let tc = UITraitCollection(traitsFrom: [
            super.traitCollection,
            UITraitCollection(
                preferredContentSizeCategory: .large)
            ])
        return tc
    }
}

// 値の呼び出し
UIApplication
    .shared
    .preferredContentSizeCategory
----

== 注意

↓してはいけないとされている！

image::/assets/img/Pasted_Image_2017_11_24_2_23.png[]

+++
<br/>
+++

でもこれ以外の方法は見当たらない or 表示が崩れる・・・

[.center]
== 現状出せる答え

「正攻法では無理だけど裏技使えばいけてるっぽい！」

== カスタムフォントについて

[%step]
* iOS 11 から使用可能。
* UIFont で扱えるならどんなフォントでも適用可能
* Interface Builder 上では設定できないのでちょっと面倒かも

[.center]
== カスタムフォント デモ

[.center]
== iOS 11 では画像もスケールできるように！

[.center]
== 画像のスケール デモ

[.center]
== デザイナー「指示書どう書けば良いの？」

== デザイン指示書の書き方

[%step]
* 今までフォントを書いていたところをText Styleに置き換える
* サイズカテゴリはデフォルトの Large とする
* スタイル名を出力できるデザインツールもあるので活用しよう

== Sketch の場合

image::/assets/img/skitched-20170914-001321.jpg[height=500]

[%step]
* 出力 👍: sketch-measure, Sympli
* 出力 🤔: InVision
* https://developer.apple.com/design/resources/[Apple が配布している Sketch リソース]が便利
** https://github.com/nilshoenson/shared-text-styles[Shared Text Styles] というプラグインで抽出可能

[NOTE.speaker]
--
LargeTitle が Title0になってたり

* とは言え、 Sketch の現最新 (46.2) では 定義済みの Text Style
を出力して別の Sketch ファイルに取り込む機能が無い。
そこで Sketch のプラグインの
https://github.com/nilshoenson/shared-text-styles[Shared Text Styles] で
エクスポートし、自分のSketchファイルにインポートして使うのが良い。
https://github.com/getflourish/Sketch-Style-Inventory というのもある。

* `iOS-11-Beta-Sketch.zip`
--

== 「テストどうすれば良いの？」

* 確認項目数 × Dynamic Type 全 12 サイズに！？
** 必ずテストするサイズの範囲を確認！
* XSmall (最小) 〜 XXXLarge (通常の最大) までで。
** （Accessibility サイズは余裕があればで良いのでは…）

[.center]
== 対応は慎重に

[NOTE.speaker]
--
* サイズによってレイアウトが崩れる
* 対応するサイズが増えれば増えるだけテスト工数が増える
--

== こんな流れが良いのでは？

[%step]
1. Dynamic Type 対応の下ごしらえをしておく
    * デザイン: Text Style でフォントを指示
    * 実装: 指示書どおりに（ただしサイズはアプリで固定）
2. お客さん「そろそろ文字サイズを変えられるようにするか」
3. 僕ら「用意しておきましたよ」ドヤッ

[NOTE.speaker]
--
* お客さんが求めている文字サイズ変更機能とは違う可能性もある
* 多少の齟齬は画面毎に traitCollection をオーバーライドすることで乗り切れると思う。
* それでもダメなら「でも Apple はこういうシステムを用意してますしそれを使った方がユーザーも幸せになれます」で乗り切りたい
--

[.center]
== そのほか

== [〜 iOS 10] 文字サイズの上限があった

image::/assets/img/ios-type-scaling-behavior.png[height=1000]

出典: https://github.com/Raizlabs/BonMot

== [iOS 11] 基本スタイルのセルに動きあり

Accessibility サイズになると…

↓iOS 10

image::/quiver-image-url/D93033E9E5C49661B7C0BA5C3B99CA0A.jpg[]

↓iOS 11

image::/quiver-image-url/D7A8A4E4D6726A1CA11E42C4E23DD08F.jpg[]

[%step]
* （罫線もちょっと太くなってる）

== 多分こんなことをやっている

[source,swift]
----
class StackTableViewCell: UITableViewCell {
    @IBOutlet private weak var stackView: UIStackView!

    override func traitCollectionDidChange(_ previousTraitCollection: UITraitCollection?) {
        super.traitCollectionDidChange(previousTraitCollection)
        updateStackViewAxis()
    }

    private func updateStackViewAxis() {
        stackView.axis =
            traitCollection
                .preferredContentSizeCategory
                .isAccessibilityCategory
                    ? .vertical
                    : .horizontal
    }
}
----


== まとめ

[%step]
* iOS 11 で Apple が本気出し始めた
* とは言えまだまだ無名の機能
* まだ様子見してる猶予はあるので今のうちから準備を
* デザイナーのDynamic Typeに関する知識が重要
* 実装は「下準備→リミッター解除」の流れが良いかも？
* （でもそもそもDynamic Typeをうまく無効化できないかも…）
* テスト対象となるサイズの範囲に気をつける

[.center]
== 今回使ったデモアプリ

https://github.com/mshibanami/DynamicTypeShowcase

[.center]
== ご清聴ありがとうございました。
