#!/usr/bin/env ruby

preprocess do
end

compile '/index-pre.*' do
    filter :slim, pretty: true
    write '/index.html'
end

compile %r{^/index/index\.([a-z]+)\..*} do |code|
    filter :slim, pretty: true
    layout '/default.slim'
    write "/#{code[0]}/index.html"
end

compile %r{/.*/index/index\.([a-z]+)\..*} do |code|
    filter :slim, pretty: true
    layout '/default.slim'
    write "/#{code[0]}/blog/index.html"
end

compile '/**/*.html' do
    layout '/default.slim'
end

compile '/**/*.md' do
    filter :commonmarker, [:DEFAULT]
    layout '/blog.*'
end

compile '/**/*.slim' do
    filter :slim, pretty: true
end

route '/**/*.{html,md,slim}' do
    if item.identifier =~ '/index.*'
        '/index.html'
    else
        item.identifier.without_ext + '/index.html'
    end
end

compile '/**/*' do
    write item.identifier.to_s
end

layout '/**/*.slim', :slim, pretty: true
layout '/**/*.erb', :erb
