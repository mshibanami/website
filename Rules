#!/usr/bin/env ruby

# https://github.com/Compass/compass/wiki/nanoc-integration
require 'compass'
Compass.add_project_configuration('compass/config.rb')

preprocess do
end

compile '/**/*' do
    # filters
    case item[:extension]
    when 'erb'
        filter :erb
    when 'scss'
        filter :sass, Compass.sass_engine_options
    when 'slim'
        filter :slim, pretty: true
    when /^(markdown|md)$/
        filter :commonmarker, [:DEFAULT]
    end

    # routes and layouts
    info = ItemRule.new(item, config)
    layout info.layout_path if info.layout_path
    write info.output_path if info.output_path
end

layout '/**/*.erb', :erb
layout '/**/*.md', :commonmarker, [:DEFAULT]
layout '/**/*.slim', :slim, pretty: true
