#!/usr/bin/env ruby

# https://github.com/Compass/compass/wiki/nanoc-integration
require 'compass'
Compass.add_project_configuration('compass/config.rb')

preprocess do
end

compile '/**/*' do
    # filters
    case item[:presentation]
    when 'revealjs'
        case item[:extension]
        when 'asciidoc', 'adoc'
            filter :asciidoctor_converter, backend: :revealjs
        when 'markdown', 'md'
            # Don't use filter.
            # The raw markdown text is embedded on the output HTML
        end
    when 'bespoke'
        filter :asciidoctor_converter, backend: :bespoke
    else
        case item[:extension]
        when 'asciidoc', 'adoc'
            filter :asciidoctor
        when 'erb'
            filter :erb
        when 'scss'
            filter :sass, Compass.sass_engine_options
        when 'slim'
            filter :slim, pretty: true
        when 'markdown', 'md'
            filter :kramdown, input: 'GFM', syntax_highlighter: 'rouge'
            # filter :commonmarker, [:DEFAULT]
        end
    end

    # layout
    layout layout_path if layout_path

    # routes
    write output_path if output_path
end

layout '/**/*.erb', :erb
layout '/**/*.md', :kramdown, input: 'GFM', syntax_highlighter: 'rouge'
# layout '/**/*.md', :commonmarker, [:DEFAULT]
layout '/**/*.slim', :slim, pretty: true
